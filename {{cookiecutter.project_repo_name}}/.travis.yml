# Config file for automatic testing at travis-ci.com
# This file will be regenerated if you run travis_pypi_setup.py

language: python
python:
  - 3.8
  - 3.7
  - 3.6
  - 3.5
os: linux
dist: xenial   # required for Python >= 3.7
branches:
  only:
    - master
jobs:
  include:
    - os: osx
      language: shell
    - env: ALLOW_FAIL=true
      python: "3.8"
  allow_failures:
    - env: ALLOW_FAIL=true

before_install:
  # Useful for debugging Travis CI environment
  - printenv
install:
  - make install
  - make start
before_script:
  # Start WPS service on port {{ cookiecutter.http_port }} on 0.0.0.0
  - {{ cookiecutter.project_slug }} start --daemon --bind-host 0.0.0.0 --port {{ cookiecutter.http_port }}
  - sleep 2
script:
  - make testall
  - make test-notebooks
  - make pep8
  - make docs
#install: pip install -U tox-travis

# Command to run tests, e.g. python setup.py test
#script: tox

{% if cookiecutter.use_pypi_deployment_with_travis == 'y' -%}
# Assuming you have installed the travis-ci CLI tool, after you
# create the Github repo and add it to Travis, run the
# following command to finish PyPI deployment setup:
# $ travis encrypt --add deploy.password
deploy:
  provider: pypi
  distributions: sdist bdist_wheel
  user: {{ cookiecutter.pypi_username }}
  password:
    secure: PLEASE_REPLACE_ME
  on:
    tags: true
    repo: {{ cookiecutter.github_username }}/{{ cookiecutter.project_slug }}
    python: 3.8
{%- endif %}
